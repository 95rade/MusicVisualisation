<html>
    <head>
        <title>Music Visualiser</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.22/require.min.js" data-main="js/main.js"></script>
        <script>
            require.config({
                baseUrl: "js",
                paths: {
                    knockout: "https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.0/knockout-min",
                    d3: "https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.12/d3.min"
                }
            });
        </script>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <section class="overlay" data-bind="visible: !playingSong()">
            <h1 data-bind="visible: !dragging() && !loadingSongContents()">
                Drag MP3 Files here!
            </h1>
            <h1 data-bind="visible: dragging">
                Okay, now drop them!
            </h1>
            <h1 data-bind="visible: loadingSongContents">
                Hold on, the file is loading.
            </h1>
            <h1 data-bind="visible: errorText, text: errorText">
                There's been an error.
            </h1>
            <div data-bind="visible: fileList().length > 0">
                <strong>Files:</strong>
                <ul data-bind="foreach: fileList()">
                    <li data-bind="text: $data"></li>
                </ul>
            </div>
        </section>
        <div class="pullout-icon" data-bind="click: togglePullout">
            open
        </div>
        <section class="pullout" data-bind="css: {hidden: !pulloutVisible() && !dragging()}">
            <div class="close">
                <a data-bind="click: togglePullout">x</a>
            </div>

            <div class="container">
                <div class="files">
                    <h4>Queue</h4>
                    <ul data-bind="foreach: fileList()">
                        <li>
                            <span class="file-name" data-bind="text: $data"></span>
                            <span class="file-remove" data-bind="click: $parent.removeFile.bind($parent, $index)">x</span>
                        </li>
                    </ul>
                    <span data-bind="visible: fileList().length === 0">
                        There are no files in the playing queue.
                    </span>
                </div>

                <div>
                    <span data-bind="text: playProgress"></span>
                    /
                    <span data-bind="text: playDuration"></span>
                    |
                    <span data-bind="click: playPause" class="play-pause">
                        <span data-bind="visible: !playingSong()">
                            Play
                        </span>
                        <span data-bind="visible: playingSong">
                            Pause
                        </span>
                    </span>
                </div>

                <div class="drag-drop-message">
                    Drag and drop audio files to add them to the queue.
                </div>
            </div>
        </section>
        <svg id="svg">
            <defs>
                <linearGradient id="freq-gradient" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0%" stop-opacity="1" />
                    <stop offset="100%" stop-opacity="0.6" />
                </linearGradient>
                <linearGradient id="waveform-gradient" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0%" stop-opacity="0.4" />
                    <stop offset="50%" stop-opacity="0.7" />
                    <stop offset="100%" stop-opacity="0.4" />
                </linearGradient>
                <mask id="vignette">
                        <rect fill="white" />
                        <rect fill="url(#x-vign)" />
                        <rect fill="url(#y-vign)" />
                        <linearGradient x1="0" x2="1" y1="0" y2="0" id="x-vign">
                            <stop offset="0%" stop-opacity="0.2" stop-color="black" />
                            <stop offset="30%" stop-opacity="0" stop-color="black" />
                            <stop offset="70%" stop-opacity="0" stop-color="black" />
                            <stop offset="100%" stop-opacity="0.2" stop-color="black" />
                        </linearGradient>
                        <linearGradient x1="0" x2="0" y1="0" y2="1" id="y-vign">
                            <stop offset="0%" stop-opacity="0.2" stop-color="black" />
                            <stop offset="30%" stop-opacity="0" stop-color="black" />
                            <stop offset="70%" stop-opacity="0" stop-color="black" />
                            <stop offset="100%" stop-opacity="0.2" stop-color="black" />
                        </linearGradient>
                </mask>
                <mask id="frequency-mask">
                    <rect x="0" y="0" fill="black" />
                    <g class="frequency">
                    </g>
                </mask>
            </defs>
            <g class="background" mask="url(#vignette)"><rect></rect></g>
            <g>
                <rect x="0" y="0" class="frequency-masked" mask="url(#frequency-mask)" fill="black">
            </g>
            <g class="waveform"><path></path></g>
        </svg>
    </body>
</html>
